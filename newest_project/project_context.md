# Контекст проекта newest_project

## Общая информация
**Дата начала разработки:** 16 октября 2025
**Текущий этап:** Этап 2 - Управление подключениями
**Прогресс:** 3/31 задач выполнено (10%)

## Цель проекта
Создание модульной системы для автоматизированного развертывания виртуальных машин в кластере Proxmox VE с использованием модульного подхода разработки.

## Архитектура разработки
Проект разрабатывается по модульному принципу:
1. Каждая функция реализуется как отдельный модуль
2. Каждый модуль тестируется независимо вручную
3. Модули интегрируются в единую систему

## Требования к технологиям
- **Язык программирования:** Python 3.8+
- **Библиотека для Proxmox API:** proxmoxer>=2.0.1
- **Формат конфигурации:** YAML (использовать библиотеку yaml, НЕ PyYAML)
- **HTTP клиент:** requests>=2.28.0 (зависимость proxmoxer)

## Структура проекта
```
newest_project/
├── core/
│   ├── modules/          # Основные модули системы
│   ├── utils/           # Базовые утилиты (Logger, Validator, Cache)
│   └── interfaces/      # Интерфейсы модулей
├── ui/                  # Пользовательский интерфейс (модульная система меню)
├── data/               # Конфигурационные файлы
├── tests/              # Тесты модулей (ручное тестирование)
├── main.py             # Точка входа
└── requirements.txt    # Зависимости
```

## Выполненные этапы

### Этап 1: Базовая инфраструктура ✅ (100%)
**Выполненные задачи:**
- [x] Создать структуру каталогов проекта
- [x] Реализовать Logger (система логирования)
- [x] Реализовать Validator (валидация данных)
- [x] Реализовать Cache (кеширование данных)
- [x] Создать файл зависимостей requirements.txt

**Результаты тестирования:**
- Logger: Все функции работают корректно (логирование в файл, разные уровни)
- Validator: 98% успешных тестов валидации
- Cache: 100% hit rate в тестах

### Этап 2: Управление подключениями (Текущий)
**Планируемые задачи:**
- [ ] Создать интерфейс для Proxmox клиента
- [ ] Реализовать Connection Manager
- [ ] Создать Proxmox Client с базовыми операциями
- [ ] Протестировать подключение к API

## Ключевые особенности реализации

### 1. Модульный подход
- Каждый модуль в отдельном файле
- Независимое тестирование каждого модуля
- Ручное тестирование без мок-объектов
- Постепенная интеграция модулей

### 2. Система логирования
- Централизованная через класс Logger
- Поддержка файловой ротации (10MB файлы, 5 backup файлов)
- Структурированные сообщения с эмодзи
- Разные уровни детализации (DEBUG, INFO, WARNING, ERROR)

### 3. Валидация данных
- Комплексная проверка всех входных данных
- Валидация подключений к Proxmox
- Проверка конфигурации развертывания
- Валидация пользователей и bridge алиасов
- Детальные отчеты об ошибках

### 4. Кеширование
- Многоуровневое кеширование с TTL
- Специализированные кеши (BridgeMappingCache, UserConfigCache)
- Автосохранение на диск в JSON формате
- Статистика использования кеша

## Технические требования

### Форматы данных
- **Пользователи Proxmox:** `user@realm` или `user@pve`
- **Bridge алиасы:** `bridge` или `bridge.vlan_id` (VLAN 1-4094)
- **VM ID:** 100-999999
- **Порты:** 1-65536

### Конфигурационные файлы
```yaml
# connections.yml
"prod-cluster":
  host: "192.168.1.100:8006"
  user: "root@pam"
  password: "encrypted_password"

# deployment_config.yml
machines:
  - device_type: "linux"
    name: "student-pc"
    template_node: "pve1"
    template_vmid: 100
    networks:
      - bridge: "vmbr0"
      - bridge: "hq.100"

# users.yml
users:
  - "student1@pve"
  - "student2@pve"
```

## Правила разработки

### 1. Структура кода
- Каждый модуль в отдельном файле
- Полная документация всех функций
- Type hints для всех параметров
- Обработка ошибок и исключений

### 2. Тестирование
- Ручное тестирование каждой функции
- Тестирование с реальными данными
- Проверка всех граничных случаев
- Документирование результатов

### 3. Интеграция
- Постепенное добавление модулей
- Проверка совместимости при интеграции
- Сохранение работоспособности существующих функций

## Следующие шаги разработки

### Короткосрочные цели (Этап 2-3)
1. Реализовать управление подключениями к Proxmox
2. Создать менеджер конфигурации для YAML файлов
3. Реализовать менеджер пользователей

### Среднесрочные цели (Этап 4-6)
1. Разработать сетевую инфраструктуру с поддержкой VLAN
2. Создать систему развертывания виртуальных машин
3. Реализовать балансировку нагрузки

### Долгосрочные цели (Этап 7-8)
1. Создать модульный пользовательский интерфейс
2. Интегрировать все модули в единое приложение
3. Провести полное тестирование системы

## Критерии качества

### Функциональность
- [ ] Все заявленные функции реализованы
- [ ] Корректная обработка ошибок
- [ ] Стабильная работа без сбоев

### Производительность
- [ ] Оптимизированное использование ресурсов
- [ ] Эффективное кеширование часто используемых данных
- [ ] Минимизация сетевых запросов

### Безопасность
- [ ] Безопасное хранение паролей
- [ ] Валидация всех входных данных
- [ ] Аутентификация по паролю и токенам

### Поддерживаемость
- [ ] Четкая структура кода
- [ ] Подробная документация
- [ ] Легкость добавления новых функций

## Риски и ограничения

### Известные ограничения
- Тестирование только ручное (без автоматизированных тестов)
- Зависимость от внешней библиотеки proxmoxer
- Требуется реальный Proxmox сервер для полного тестирования

### Риски
- Сложность интеграции модулей
- Возможные проблемы с совместимостью библиотек
- Необходимость отладки на реальном оборудовании

## Контактная информация
- **Проект:** newest_project
- **Версия:** 0.1.0 (development)
- **Дата последнего обновления:** 16 октября 2025
